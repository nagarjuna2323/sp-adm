<!DOCTYPE html>
<html>
<head>
  <title>Backend Demo Frontend</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input, button, select { margin: 5px 0; padding: 8px; width: 320px; }
    label { font-weight: bold; }
    hr { margin: 24px 0; }
    .success { color: green; }
    .error { color: red; }
    .section { margin-bottom: 40px; }
    .smaller { font-size: 0.9em; color: #555; }
    pre { background: #f8f8f8; padding: 8px; overflow-x: auto; }
  </style>
</head>
<body>

  <h1>Backend Demo Frontend</h1>
  <div id="message"></div>

  <!-- Register -->
  <div class="section">
    <h2>Register User</h2>
    <select id="registerRole">
      <option value="student">Student</option>
      <option value="admin">Admin</option>
      <option value="manager">Manager</option>
      <option value="superadmin">Superadmin</option>
    </select><br />
    <input id="registerUsername" placeholder="Username"/><br />
    <input id="registerPassword" placeholder="Password" type="password"/><br />
    <button onclick="registerUser()">Register</button>
  </div><hr />

  <!-- Login -->
  <div class="section">
    <h2>Login</h2>
    <input id="loginUsername" placeholder="Username"/><br />
    <input id="loginPassword" placeholder="Password" type="password"/><br />
    <button onclick="loginUser()">Login</button>
  </div><hr />

  <!-- List Superadmin Users -->
  <div class="section">
    <h2>List All Users (Superadmin)</h2>
    <button onclick="listSuperadminUsers()">Load Users</button>
    <pre id="usersList"></pre>
  </div>

  <!-- Get Admin User by ID -->
  <div class="section">
    <h2>Get Admin User by ID</h2>
    <input id="adminIdLookup" placeholder="Admin ID"/>
    <button onclick="getAdminById()">Get Admin</button>
    <pre id="adminDetail"></pre>
  </div>

  <!-- List All Students (Superadmin) -->
  <div class="section">
    <h2>List All Students (Superadmin)</h2>
    <button onclick="listAllStudents()">Show Students</button>
    <pre id="studentsList"></pre>
  </div>

  <!-- Get Student by ID (Superadmin) -->
  <div class="section">
    <h2>Get Student by ID (Superadmin)</h2>
    <input id="studentIdLookup" placeholder="Student ID"/>
    <button onclick="getStudentById()">Get Student</button>
    <pre id="studentDetail"></pre>
  </div>

  <!-- Student Profile -->
  <div class="section">
    <h2>View Student Profile</h2>
    <input id="profileStudentId" placeholder="Student ID"/>
    <button onclick="getStudentProfile()">View Profile</button>
    <pre id="profileDetail"></pre>
    <div class="smaller">(Endpoint: /students/{id}/profile)</div>
  </div>

  <!-- Assign Task to Manager (Superadmin) -->
  <div class="section">
    <h2>Assign Task to Manager (Superadmin)</h2>
    <input id="taskIdToManager" placeholder="Task ID"/>
    <input id="managerId" placeholder="Manager ID"/>
    <button onclick="assignTaskToManager()">Assign</button>
  </div>

  <!-- Assign Task to Admin (Manager) -->
  <div class="section">
    <h2>Assign Task to Admin (Manager)</h2>
    <input id="taskIdToAdmin" placeholder="Task ID"/>
    <input id="adminIdAssign" placeholder="Admin ID"/>
    <button onclick="assignTaskToAdmin()">Assign</button>
  </div>

  <script>
    function showMessage(msg, isError = false) {
      const div = document.getElementById("message");
      div.textContent = msg;
      div.className = isError ? "error" : "success";
      setTimeout(() => { div.textContent = ""; }, 4500);
    }

    let token = localStorage.getItem("token") || "";

    // --- Registration ---
    async function registerUser() {
      const role = document.getElementById("registerRole").value;
      const username = document.getElementById("registerUsername").value;
      const password = document.getElementById("registerPassword").value;
      if(!username || !password){
        showMessage("Enter username and password.", true); return;
      }
      let url = "/register/" + role;
      let body = JSON.stringify({username, password});
      let res = await fetch(url, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body
      });
      if(res.ok) showMessage(`Registered as ${role}!`);
      else showMessage("Registration failed: " + await res.text(), true);
    }

    // --- Login ---
    async function loginUser() {
      const username = document.getElementById("loginUsername").value;
      const password = document.getElementById("loginPassword").value;
      if(!username || !password){
        showMessage("Enter username and password.", true); return;
      }
      let res = await fetch("/login", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ username, password })
      });
      if(res.ok) {
        let data = await res.json();
        token = data.token;
        localStorage.setItem("token", token);
        showMessage("Login successful!");
      } else showMessage("Login failed: " + await res.text(), true);
    }

    // --- List all users (superadmin) ---
    async function listSuperadminUsers() {
      if(!token){ showMessage("Login first.", true); return; }
      let res = await fetch("/superadmin/api/users",
        { headers: {"Authorization": "Bearer " + token } });
      if(res.ok) document.getElementById("usersList").textContent = JSON.stringify(await res.json(), null, 2);
      else document.getElementById("usersList").textContent = "Error: " + await res.text();
    }

    // --- Get Admin user by ID ---
    async function getAdminById() {
      if(!token){ showMessage("Login first.", true); return; }
      const id = document.getElementById("adminIdLookup").value;
      if(!id) { showMessage("Enter Admin ID.", true); return; }
      let res = await fetch(`/superadmin/api/users/Admin/${id}`,
        { headers: {"Authorization": "Bearer " + token } });
      if(res.ok) document.getElementById("adminDetail").textContent = JSON.stringify(await res.json(), null, 2);
      else document.getElementById("adminDetail").textContent = "Error: " + await res.text();
    }

    // --- List all students ---
    async function listAllStudents() {
      if(!token){ showMessage("Login first.", true); return; }
      let res = await fetch("/superadmin/api/students",
        { headers: {"Authorization": "Bearer " + token } });
      if(res.ok) document.getElementById("studentsList").textContent = JSON.stringify(await res.json(), null, 2);
      else document.getElementById("studentsList").textContent = "Error: " + await res.text();
    }

    // --- Get student by ID ---
    async function getStudentById() {
      if(!token){ showMessage("Login first.", true); return; }
      const id = document.getElementById("studentIdLookup").value;
      if(!id) { showMessage("Enter Student ID.", true); return; }
      let res = await fetch(`/superadmin/api/students/${id}`,
        { headers: {"Authorization": "Bearer " + token } });
      if(res.ok) document.getElementById("studentDetail").textContent = JSON.stringify(await res.json(), null, 2);
      else document.getElementById("studentDetail").textContent = "Error: " + await res.text();
    }

    // --- Student profile ---
    async function getStudentProfile() {
      if(!token){ showMessage("Login first.", true); return; }
      const id = document.getElementById("profileStudentId").value;
      if(!id) { showMessage("Enter Student ID.", true); return; }
      let res = await fetch(`/students/${id}/profile`, {
        headers: {"Authorization": "Bearer " + token }
      });
      if(res.ok) document.getElementById("profileDetail").textContent = JSON.stringify(await res.json(), null, 2);
      else document.getElementById("profileDetail").textContent = "Error: " + await res.text();
    }

    // --- Assign task to manager ---
    async function assignTaskToManager() {
      if(!token){ showMessage("Login first.", true); return; }
      const taskId = document.getElementById("taskIdToManager").value;
      const managerId = document.getElementById("managerId").value;
      if(!taskId || !managerId){
        showMessage("Enter Task ID and Manager ID.", true); return;
      }
      let res = await fetch("/superadmin/api/tasks/assign-to-manager", {
        method: "POST",
        headers: {"Authorization": "Bearer " + token, "Content-Type": "application/json"},
        body: JSON.stringify({ taskId, managerId })
      });
      if(res.ok) showMessage("Task assigned to manager.");
      else showMessage("Error: " + await res.text(), true);
    }

    // --- Assign task to admin ---
    async function assignTaskToAdmin() {
      if(!token){ showMessage("Login first.", true); return; }
      const taskId = document.getElementById("taskIdToAdmin").value;
      const adminId = document.getElementById("adminIdAssign").value;
      if(!taskId || !adminId){
        showMessage("Enter Task ID and Admin ID.", true); return;
      }
      let res = await fetch("/manager/api/tasks/assign-to-admin", {
        method: "POST",
        headers: {"Authorization": "Bearer " + token, "Content-Type": "application/json"},
        body: JSON.stringify({ taskId, adminId })
      });
      if(res.ok) showMessage("Task assigned to admin.");
      else showMessage("Error: " + await res.text(), true);
    }
  </script>
</body>
</html>
